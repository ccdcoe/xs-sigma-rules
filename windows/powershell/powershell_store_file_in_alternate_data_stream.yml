author: frack113
date: 2021/09/02
definition: EnableScriptBlockLogging must be set to enable
description: Storing files in Alternate Data Stream (ADS) similar to Astaroth malware.
detection:
  condition: selection_id and selection_compspec
  selection_compspec:
    winlog.event_data.ScriptBlockText|contains|all:
    - Start-Process
    - '-FilePath "$env:comspec" '
    - '-ArgumentList '
    - '>'
  selection_id:
    winlog.event_id: 4104
falsepositives:
- Unknown
id: a699b30e-d010-46c8-bbd1-ee2e26765fe9
level: medium
logsource:
  definition: EnableScriptBlockLogging must be set to enable
  product: windows
  service: powershell
product: windows
references:
- https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.004/T1564.004.md
service: powershell
status: experimental
tags:
- attack.defense_evasion
- attack.t1564.004
title: Powershell Store File In Alternate Data Stream
